# 分布式唯一ID的几种生成方案

## 需求

在业务开发中，大量场景需要唯一ID来进行标识：用户需要唯一身份标识、商品需要唯一标识、消息需要唯一标识、事件需要唯一标识等，都需要全局唯一ID，尤其是复杂的分布式业务场景中全局唯一ID更为重要。

## 分布式唯一ID的特性或要求

- 唯一性：生成的ID全局唯一，在特定范围冲突概率极小。
- 有序性：生成的ID按某种规则有序，便于数据库插入及排序。
- 可用性：可保证高并发下的可用性，确保任何时候都能正确的生成ID。
- 自主性：分布式环境下不依赖中心认证即可自行生成ID。
- 安全性：不暴露系统和业务的信息。如订单数，用户数等。

## 分布式唯一ID的生成方案

- UUID生成

- 数据库自增ID

  核心思想：使用数据库的id自增策略(如：Mysql的auto_increment)。

  优点：

   - 简单，天然有序。

  缺点：

   - 并发性不好
   - 数据库写压力大
   - 数据库故障后不可使用
   - 存在数量泄露风险

  针对以上缺点的优化方案：

   - 数据库水平拆分，设置不同的初始值和相同的自增步长

     核心思想：将数据库进行水平拆分，每个数据库设置不同的初始值和相同的自增步长。

     缺点：扩容问题，扩容时会出项无ID初始值可分的窘境。

     解决方案：

      	1. 根据扩容考虑决定步长
      	2. 增加其他位标记区分扩容

   - 批量缓存自增ID

     核心思想：如果使用单台机器做ID生成，可以避免固定步长带来的扩容问题。

     具体做法：每次批量生成一批ID给不同的机器去慢慢消费，这样数据库的压力也会减小到N分之一，且故障后可坚持一段时间。

     缺点：服务器重启、单点故障会造成ID不连续。

   - Redis生成ID

- snowflake雪花算法